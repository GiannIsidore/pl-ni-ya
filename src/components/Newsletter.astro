---
// Newsletter Section - Email subscription
---

<section class="px-6 lg:px-12 pb-16 lg:pb-24 bg-neutral-900">
  <div class="max-w-7xl mx-auto">
    <div class="relative overflow-hidden rounded-3xl bg-gradient-to-br from-neutral-800 via-neutral-800 to-neutral-900 border border-neutral-700 p-8 lg:p-16 scroll-fade-in">
      <!-- Background decorative elements -->
      <div class="absolute top-0 right-0 w-96 h-96 bg-blue-600/10 rounded-full blur-3xl -translate-y-1/2 translate-x-1/2"></div>
      <div class="absolute bottom-0 left-0 w-64 h-64 bg-purple-600/10 rounded-full blur-3xl translate-y-1/2 -translate-x-1/2"></div>
      
      <div class="relative z-10 max-w-2xl">
        <h2 
          class="text-white mb-4"
          style="font-family: 'Bebas Neue', sans-serif; font-weight: 400; font-style: normal; font-size: 80px; line-height: 80px; letter-spacing: -0.02em;"
        >
          NEWSLETTER
        </h2>
        <p 
          class="text-gray-400 mb-8"
          style="font-family: 'Montserrat', sans-serif; font-weight: 500; font-size: 18px; line-height: 28px;"
        >
          Stay updated through our weekly topics. Get the latest insights on technology, programming, and creative digital work delivered to your inbox.
        </p>
        
        <form id="newsletter-form" class="flex flex-col sm:flex-row gap-4">
          <div class="flex-1 relative">
            <input 
              type="email" 
              id="newsletter-email"
              name="email"
              placeholder="Enter your email address"
              required
              class="w-full px-6 py-4 bg-neutral-900/80 border border-neutral-600 rounded-xl text-white placeholder-gray-500 focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 transition-all"
              style="font-family: 'Montserrat', sans-serif;"
            />
          </div>
          <button 
            type="submit"
            id="newsletter-submit"
            class="px-8 py-4 bg-white text-neutral-900 font-semibold rounded-xl hover:bg-gray-100 transition-colors flex items-center justify-center gap-2 min-w-[160px]"
            style="font-family: 'Montserrat', sans-serif;"
          >
            <span id="submit-text">Subscribe</span>
            <svg id="submit-spinner" class="hidden w-5 h-5 animate-spin" fill="none" viewBox="0 0 24 24">
              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
              <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
          </button>
        </form>
        
        <!-- Success Message -->
        <div id="newsletter-success" class="hidden mt-4 p-4 bg-green-500/10 border border-green-500/20 rounded-xl">
          <p class="text-green-400 flex items-center gap-2">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
            </svg>
            <span>Thank you for subscribing! Check your inbox for confirmation.</span>
          </p>
        </div>
        
        <!-- Error Message -->
        <div id="newsletter-error" class="hidden mt-4 p-4 bg-red-500/10 border border-red-500/20 rounded-xl">
          <p class="text-red-400 flex items-center gap-2">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
            </svg>
            <span id="error-text">Something went wrong. Please try again.</span>
          </p>
        </div>
        
        <p class="text-gray-500 text-sm mt-4" style="font-family: 'Montserrat', sans-serif;">
          No spam, unsubscribe at any time. We respect your privacy.
        </p>
      </div>
    </div>
  </div>
</section>

<script>
  const form = document.getElementById('newsletter-form') as HTMLFormElement;
  const emailInput = document.getElementById('newsletter-email') as HTMLInputElement;
  const submitBtn = document.getElementById('newsletter-submit') as HTMLButtonElement;
  const submitText = document.getElementById('submit-text') as HTMLSpanElement;
  const submitSpinner = document.getElementById('submit-spinner') as unknown as SVGElement;
  const successMsg = document.getElementById('newsletter-success') as HTMLDivElement;
  const errorMsg = document.getElementById('newsletter-error') as HTMLDivElement;
  const errorText = document.getElementById('error-text') as HTMLSpanElement;

  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const email = emailInput.value.trim();
    
    // Reset messages
    successMsg.classList.add('hidden');
    errorMsg.classList.add('hidden');
    
    // Show loading state
    submitBtn.disabled = true;
    submitText.textContent = 'Subscribing...';
    submitSpinner.classList.remove('hidden');
    
    try {
      const response = await fetch('/api/newsletter/subscribe', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email })
      });
      
      const data = await response.json();
      
      if (response.ok) {
        successMsg.classList.remove('hidden');
        emailInput.value = '';
      } else {
        errorText.textContent = data.error || 'Something went wrong. Please try again.';
        errorMsg.classList.remove('hidden');
      }
    } catch (error) {
      errorText.textContent = 'Network error. Please check your connection and try again.';
      errorMsg.classList.remove('hidden');
    } finally {
      submitBtn.disabled = false;
      submitText.textContent = 'Subscribe';
      submitSpinner.classList.add('hidden');
    }
  });
</script>
