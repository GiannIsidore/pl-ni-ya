generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["driverAdapters"]
}

datasource db {
  provider = "mysql"
}

model account {
  id                    String    @id
  accountId             String
  providerId            String
  userId                String
  accessToken           String?   @db.Text
  refreshToken          String?   @db.Text
  idToken               String?   @db.Text
  accessTokenExpiresAt  DateTime?
  refreshTokenExpiresAt DateTime?
  scope                 String?
  password              String?
  createdAt             DateTime  @default(now())
  updatedAt             DateTime
  user                  user      @relation(fields: [userId], references: [id], onDelete: Cascade, map: "Account_userId_fkey")

  @@unique([providerId, accountId], map: "Account_providerId_accountId_key")
  @@index([userId], map: "Account_userId_idx")
}

model auditlog {
  id          Int      @id @default(autoincrement())
  action      String
  targetType  String
  targetId    String
  performedBy String
  details     String?  @db.Text
  ipAddress   String?
  createdAt   DateTime @default(now())
  user        user     @relation(fields: [performedBy], references: [id], map: "AuditLog_performedBy_fkey")

  @@index([createdAt], map: "AuditLog_createdAt_idx")
  @@index([performedBy], map: "AuditLog_performedBy_idx")
  @@index([targetType, targetId], map: "AuditLog_targetType_targetId_idx")
}

model blog {
  id                                Int         @id @default(autoincrement())
  slug                              String      @unique(map: "Blog_slug_key")
  title                             String
  excerpt                           String      @db.Text
  content                           String      @db.LongText
  views                             Int         @default(0)
  status                            blog_status @default(DRAFT)
  isFeatured                        Boolean     @default(false)
  publishedAt                       DateTime?
  readTime                          Int?
  categoryId                        Int?
  authorId                          String?
  createdAt                         DateTime    @default(now())
  updatedAt                         DateTime
  featuredImageId                   Int?        @unique(map: "Blog_featuredImageId_key")
  user                              user?       @relation(fields: [authorId], references: [id], map: "Blog_authorId_fkey")
  category                          category?   @relation(fields: [categoryId], references: [id], map: "Blog_categoryId_fkey")
  image_blog_featuredImageIdToimage image?      @relation("blog_featuredImageIdToimage", fields: [featuredImageId], references: [id], map: "Blog_featuredImageId_fkey")
  blogtag                           blogtag[]
  image_image_blogIdToblog          image[]     @relation("image_blogIdToblog")

  @@index([authorId], map: "Blog_authorId_idx")
  @@index([categoryId], map: "Blog_categoryId_idx")
  @@index([isFeatured], map: "Blog_isFeatured_idx")
  @@index([publishedAt], map: "Blog_publishedAt_idx")
  @@index([status], map: "Blog_status_idx")
}

model blogtag {
  blogId Int
  tagId  Int
  blog   blog @relation(fields: [blogId], references: [id], onDelete: Cascade, map: "BlogTag_blogId_fkey")
  tag    tag  @relation(fields: [tagId], references: [id], onDelete: Cascade, map: "BlogTag_tagId_fkey")

  @@id([blogId, tagId])
  @@index([blogId], map: "BlogTag_blogId_idx")
  @@index([tagId], map: "BlogTag_tagId_idx")
}

model category {
  id          Int     @id @default(autoincrement())
  name        String  @unique(map: "Category_name_key")
  slug        String  @unique(map: "Category_slug_key")
  description String? @db.Text
  icon        String?
  blog        blog[]

  @@index([slug], map: "Category_slug_idx")
}

model comment {
  id            Int       @id @default(autoincrement())
  content       String    @db.LongText
  threadId      Int
  authorId      String
  parentId      Int?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime
  user          user      @relation(fields: [authorId], references: [id], map: "Comment_authorId_fkey")
  comment       comment?  @relation("commentTocomment", fields: [parentId], references: [id], map: "Comment_parentId_fkey")
  other_comment comment[] @relation("commentTocomment")
  thread        thread    @relation(fields: [threadId], references: [id], map: "Comment_threadId_fkey")
  like          like[]

  @@index([authorId], map: "Comment_authorId_idx")
  @@index([parentId], map: "Comment_parentId_idx")
  @@index([threadId], map: "Comment_threadId_idx")
}

model forum {
  id          Int      @id @default(autoincrement())
  name        String
  description String?  @db.Text
  slug        String   @unique(map: "Forum_slug_key")
  createdAt   DateTime @default(now())
  updatedAt   DateTime
  thread      thread[]

  @@index([slug], map: "Forum_slug_idx")
}

model image {
  id                               Int    @id @default(autoincrement())
  url                              String
  blogId                           Int?
  blog_blog_featuredImageIdToimage blog?  @relation("blog_featuredImageIdToimage")
  blog_image_blogIdToblog          blog?  @relation("image_blogIdToblog", fields: [blogId], references: [id], map: "Image_blogId_fkey")

  @@index([blogId], map: "Image_blogId_idx")
}

model like {
  id        Int      @id @default(autoincrement())
  userId    String
  threadId  Int?
  commentId Int?
  createdAt DateTime @default(now())
  comment   comment? @relation(fields: [commentId], references: [id], map: "Like_commentId_fkey")
  thread    thread?  @relation(fields: [threadId], references: [id], map: "Like_threadId_fkey")
  user      user     @relation(fields: [userId], references: [id], map: "Like_userId_fkey")

  @@unique([userId, commentId], map: "Like_userId_commentId_key")
  @@unique([userId, threadId], map: "Like_userId_threadId_key")
  @@index([commentId], map: "Like_commentId_idx")
  @@index([threadId], map: "Like_threadId_idx")
  @@index([userId], map: "Like_userId_idx")
}

model session {
  id        String   @id
  expiresAt DateTime
  token     String   @unique(map: "Session_token_key")
  ipAddress String?
  userAgent String?
  userId    String
  createdAt DateTime @default(now())
  updatedAt DateTime
  user      user     @relation(fields: [userId], references: [id], onDelete: Cascade, map: "Session_userId_fkey")

  @@index([userId], map: "Session_userId_idx")
}

model tag {
  id      Int       @id @default(autoincrement())
  name    String    @unique(map: "Tag_name_key")
  slug    String    @unique(map: "Tag_slug_key")
  blogtag blogtag[]

  @@index([slug], map: "Tag_slug_idx")
}

model thread {
  id        Int           @id @default(autoincrement())
  title     String
  content   String        @db.LongText
  slug      String        @unique(map: "Thread_slug_key")
  forumId   Int
  authorId  String
  status    thread_status @default(OPEN)
  isLocked  Boolean       @default(false)
  isPinned  Boolean       @default(false)
  views     Int           @default(0)
  createdAt DateTime      @default(now())
  updatedAt DateTime
  comment   comment[]
  like      like[]
  user      user          @relation(fields: [authorId], references: [id], map: "Thread_authorId_fkey")
  forum     forum         @relation(fields: [forumId], references: [id], map: "Thread_forumId_fkey")

  @@index([authorId], map: "Thread_authorId_idx")
  @@index([forumId], map: "Thread_forumId_idx")
  @@index([isLocked], map: "Thread_isLocked_idx")
  @@index([isPinned], map: "Thread_isPinned_idx")
  @@index([slug], map: "Thread_slug_idx")
  @@index([status], map: "Thread_status_idx")
}

model user {
  id            String     @id
  username      String     @unique(map: "User_username_key")
  email         String     @unique(map: "User_email_key")
  emailVerified Boolean    @default(false)
  name          String?
  avatar        String?    @db.Text
  role          user_role  @default(USER)
  isBanned      Boolean    @default(false)
  bannedAt      DateTime?
  bannedBy      String?
  banReason     String?    @db.Text
  bannedUntil   DateTime?
  createdAt     DateTime   @default(now())
  updatedAt     DateTime
  account       account[]
  auditlog      auditlog[]
  blog          blog[]
  comment       comment[]
  like          like[]
  session       session[]
  thread        thread[]

  @@index([isBanned], map: "User_isBanned_idx")
  @@index([role], map: "User_role_idx")
}

model verification {
  id         String   @id
  identifier String
  value      String
  expiresAt  DateTime
  createdAt  DateTime @default(now())
  updatedAt  DateTime

  @@unique([identifier, value], map: "Verification_identifier_value_key")
}

enum blog_status {
  DRAFT
  PUBLISHED
  ARCHIVED
}

enum thread_status {
  OPEN
  CLOSED
  RESOLVED
}

enum user_role {
  USER
  MODERATOR
  ADMIN
}
